<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stok Bahan Ajar - UT Learning Materials</title>
    <link rel="stylesheet" href="css/vue.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
</head>
<body>
    <div id="stok-app">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <a href="dashboard.html" class="btn-back"><b>Kembali Ke Dashboard</b></a>
                        <h1>Stok Bahan Ajar</h1>
                    </div>
                    <nav>
                        <ul>
                            <li><a href="stok_vue.html" class="nav-link"><b>Stok Bahan Ajar</b></a></li>
                            <li><a href="tracking_vue.html" class="nav-link"><b>Tracking DO</b></a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>

        <main class="container">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìö Stok Bahan Ajar</h2>
                    <button class="btn btn-primary" @click="showAddForm = true">Tambah Bahan Ajar</button>
                </div>

                <!-- Filter Section -->
                <div class="filters">
                    <div class="filter-group">
                        <label for="filter-upbjj">UT Daerah</label>
                        <select id="filter-upbjj" v-model="filter.upbjj">
                            <option value="">Semua</option>
                            <option v-for="upbjj in upbjjList" :value="upbjj">{{ upbjj }}</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-kategori">Kategori</label>
                        <select id="filter-kategori" v-model="filter.kategori">
                            <option value="">Semua</option>
                            <option v-for="kategori in kategoriList" :value="kategori">{{ kategori }}</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-status">Status Stok</label>
                        <select id="filter-status" v-model="filter.status">
                            <option value="">Semua</option>
                            <option value="aman">Aman</option>
                            <option value="menipis">Menipis</option>
                            <option value="kosong">Kosong</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="sort-by">Urutkan Berdasarkan</label>
                        <select id="sort-by" v-model="sortBy">
                            <option value="judul">Judul</option>
                            <option value="qty">Stok</option>
                            <option value="harga">Harga</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-outline" @click="resetFilters">Reset Filter</button>
                    </div>
                </div>

                <!-- Stok Table -->
                <div v-if="filteredStok.length > 0">
                    <table>
                        <thead>
                            <tr>
                                <th>Kode</th>
                                <th>Judul</th>
                                <th>Kategori</th>
                                <th>UT Daerah</th>
                                <th>Lokasi Rak</th>
                                <th>Harga</th>
                                <th>Stok</th>
                                <th>Safety</th>
                                <th>Status</th>
                                <th>Catatan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in paginatedStok" :key="item.kode">
                                <td>{{ item.kode }}</td>
                                <td>{{ item.judul }}</td>
                                <td>{{ item.kategori }}</td>
                                <td>{{ item.upbjj }}</td>
                                <td>{{ item.lokasiRak }}</td>
                                <td>Rp {{ formatNumber(item.harga) }}</td>
                                <td>{{ item.qty }}</td>
                                <td>{{ item.safety }}</td>
                                <td>
                                    <span v-if="item.qty >= item.safety" class="status-aman">‚úÖ Aman</span>
                                    <span v-else-if="item.qty > 0" class="status-menipis">‚ö†Ô∏è Menipis</span>
                                    <span v-else class="status-kosong">‚ùå Kosong</span>
                                </td>
                                <td v-html="item.catatanHTML"></td>
                                <td>
                                    <button class="btn btn-warning" @click="editItem(item)">Edit</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Pagination -->
                    <div class="pagination">
                        <div 
                            v-for="page in totalPages" 
                            :key="page" 
                            class="page-item" 
                            :class="{active: currentPageStok === page}"
                            @click="currentPageStok = page"
                        >
                            {{ page }}
                        </div>
                    </div>
                </div>
                <div v-else class="empty-state">
                    <i>üìö</i>
                    <h3>Tidak ada data stok yang sesuai dengan filter</h3>
                    <p>Coba ubah kriteria filter Anda</p>
                </div>
            </div>

            <!-- Form Tambah/Edit Bahan Ajar -->
            <div v-if="showAddForm || editingItem" class="card">
                <div class="card-header">
                    <h2 class="card-title">{{ editingItem ? 'Edit' : 'Tambah' }} Bahan Ajar</h2>
                </div>

                <div v-if="formMessage" :class="['alert', formMessage.type === 'success' ? 'alert-success' : 'alert-danger']">
                    {{ formMessage.text }}
                </div>

                <form @submit.prevent="saveItem">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="kode">Kode Bahan Ajar </label>
                            <input 
                                type="text" 
                                id="kode" 
                                v-model="form.kode" 
                                required 
                                :disabled="editingItem"
                            >
                        </div>
                        <div class="form-group">
                            <label for="judul">Judul </label>
                            <input 
                                type="text" 
                                id="judul" 
                                v-model="form.judul" 
                                required
                            >
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="kategori">Kategori </label>
                            <select id="kategori" v-model="form.kategori" required>
                                <option value="">Pilih Kategori</option>
                                <option v-for="kategori in kategoriList" :value="kategori">{{ kategori }}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="upbjj">UT Daerah </label>
                            <select id="upbjj" v-model="form.upbjj" required>
                                <option value="">Pilih UT Daerah</option>
                                <option v-for="upbjj in upbjjList" :value="upbjj">{{ upbjj }}</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="lokasiRak">Lokasi Rak </label>
                            <input 
                                type="text" 
                                id="lokasiRak" 
                                v-model="form.lokasiRak" 
                                required
                            >
                        </div>
                        <div class="form-group">
                            <label for="harga">Harga </label>
                            <input 
                                type="number" 
                                id="harga" 
                                v-model="form.harga" 
                                required
                                min="0"
                            >
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="qty">Jumlah Stok </label>
                            <input 
                                type="number" 
                                id="qty" 
                                v-model="form.qty" 
                                required
                                min="0"
                            >
                        </div>
                        <div class="form-group">
                            <label for="safety">Safety Stock </label>
                            <input 
                                type="number" 
                                id="safety" 
                                v-model="form.safety" 
                                required
                                min="0"
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="catatanHTML">Catatan</label>
                        <textarea 
                            id="catatanHTML" 
                            v-model="form.catatanHTML" 
                            rows="3"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">{{ editingItem ? 'Update' : 'Simpan' }}</button>
                        <button type="button" class="btn btn-outline" @click="cancelForm">Batal</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script src="js/stok-app.js"></script>
</body>
</html>